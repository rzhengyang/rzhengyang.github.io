<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" /> <!--[if lte IE 9]><meta http-equiv="refresh" content="0;url=/ie.html"><![endif]--> <title>Rzy_test2</title> <meta name="description" content="视频播放，选用videoview进行播放器的设计"> <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,400italic,600|Droid+Sans+Mono' rel='stylesheet' type='text/css'> <link rel="stylesheet" href="/css/main.css"> <link rel="canonical" href="http://rzhengyang.me/2016/09/10/rzy_test2.html"> <link rel="alternate" type="application/rss+xml" title="羊兄台在这里" href="http://rzhengyang.me/feed.xml" /> <script src="/assets/js/prefixfree.js"></script> </head> <body> <aside id="sidebar"> <div id="sidebar-left"> <a id="sidebar-avatar" href="/"> <img id="sidebar-avatar-img" alt="" src="/assets/img/avatar.jpg"/> </a> <div id="sidebar-social"> <a href="/feed.xml" class="sidebar-social-icon feed"></a> <a href="mailto:rzhengyang@163.com" class="sidebar-social-icon email"></a> <a href="https://github.com/rzhengyang" class="sidebar-social-icon github" target="_blank"></a> </div> <ul id="sidebar-tags"> <li class="sidebar-tag active" data-filter="all">全部文章</li> <li class="sidebar-tag" data-filter="生活">生活</li> <li class="sidebar-tag" data-filter="技术">技术</li> <li class="sidebar-tag" data-filter="精分">精分</li> <li class="sidebar-tag" data-filter="旅行">旅行</li> <li class="sidebar-tag" data-filter="读书">读书</li> <li class="sidebar-tag" data-filter="关于">关于</li> <!--<li class="sidebar-tag" data-filter="精分">精分</li>--> <!--<li class="sidebar-tag" data-filter="技术">技术</li>--> <!--<li class="sidebar-tag" data-filter="旅行">旅行</li>--> <!--<li class="sidebar-tag" data-filter="读书">读书</li>--> </ul> </div> <div id="sidebar-right"> <div id="search-box"> <input id="search-input" type="text" placeholder="Search" /> </div> <nav id="toc"> <a class="toc-link" data-tags="技术 读书 精分" href="/%E6%8A%80%E6%9C%AF/%E8%AF%BB%E4%B9%A6/%E7%B2%BE%E5%88%86/2016/09/27/thanks.html"> Hello </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2016/09/13/markdown_test3.html"> Markdown_test3 </a> <a class="toc-link" data-tags="" href="/2016/09/10/rzy_test2.html"> Rzy_test2 </a> <a class="toc-link" data-tags="" href="/2016/09/08/hello-newBlog_test1.html"> Hello Newblog_test1 </a> <a class="toc-link" data-tags="旅行" href="/%E6%97%85%E8%A1%8C/2015/03/09/welcome-to-jekyll.html"> Welcome to Jekyll! </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/01/11/%E6%88%91%E7%9A%84%E4%B8%AD%E6%96%87%E6%B5%8B%E8%AF%95.html"> 我的中文测试 </a> <a class="toc-link" data-tags="精分" href="/%E7%B2%BE%E5%88%86/2009/01/28/aaa-bbb.html"> Aaa Bbb </a> </nav> </div> </aside> <main id="main"> <article class="post container"> <div class="post-meta"> <span class="post-meta-span date">2016 September 10</span> </div> <h1 class="post-title">Rzy_test2</h1> <h1 id="videoview">视频播放，选用videoview进行播放器的设计</h1> <h2 id="layoutvideoview">在layout中，加入videoview控件。</h2> <div class="highlighter-rouge"><pre class="highlight"><code>	X=1;
	who ==2?

</code></pre></div> <div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;VideoView</span>

    <span class="na">android:id=</span><span class="s">"@+id/vido_view"</span>

    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>

    <span class="na">android:layout_height=</span><span class="s">"241dp"</span> <span class="nt">/&gt;</span>


</code></pre></div> <h2 id="mainactivityvideoview">在Mainactivity中使用videoview</h2> <p>oncreat方法中</p> <div class="language-xml highlighter-rouge"><pre class="highlight"><code>
videoView = (VideoView)findViewById(R.id.video_view);

initVideoPath();


</code></pre></div> <p>initVideoPath()</p> <div class="language-java highlighter-rouge"><pre class="highlight"><code>
<span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">(),</span><span class="s">"1.mp4"</span><span class="o">);</span><span class="c1">//设置播放路径</span>

<span class="n">videoView</span><span class="o">.</span><span class="na">setVideoPath</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getPath</span><span class="o">());</span><span class="c1">//指定视频文件的路径</span>

<span class="k">if</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">()){</span>

    <span class="n">Log</span><span class="o">.</span><span class="na">v</span><span class="o">(</span><span class="s">"Billy"</span><span class="o">,</span><span class="s">"exists"</span><span class="o">);</span>   

<span class="o">}</span>

</code></pre></div> <p>onClick方法</p> <div class="language-java highlighter-rouge"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>

<span class="k">switch</span> <span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">getId</span><span class="o">())</span> <span class="o">{</span>

<span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">play</span><span class="o">:</span>

    <span class="k">if</span> <span class="o">(!</span><span class="n">mediaPlayer</span><span class="o">.</span><span class="na">isPlaying</span><span class="o">())</span> <span class="o">{</span>

    <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span> <span class="c1">// 开始播放</span>

    <span class="o">}</span>

<span class="k">break</span><span class="o">;</span>

<span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">pause</span><span class="o">:</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">mediaPlayer</span><span class="o">.</span><span class="na">isPlaying</span><span class="o">())</span> <span class="o">{</span>

    <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">pause</span><span class="o">();</span> <span class="c1">// 暂停播放</span>

    <span class="o">}</span>

<span class="k">break</span><span class="o">;</span>

<span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">stop</span><span class="o">:</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">mediaPlayer</span><span class="o">.</span><span class="na">isPlaying</span><span class="o">())</span> <span class="o">{</span>

    <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span> <span class="c1">// 停止播放</span>

    <span class="n">initMediaPlayer</span><span class="o">();</span>

    <span class="o">}</span>

<span class="k">break</span><span class="o">;</span>

<span class="k">default</span><span class="o">:</span>

<span class="k">break</span><span class="o">;</span>

<span class="o">}</span>

<span class="o">}</span>

</code></pre></div> <p>在onDestory中进行释放</p> <div class="language-java highlighter-rouge"><pre class="highlight"><code>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>

    <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">mediaPlayer</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>

        <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>

    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div> <h3 id="videoviewsd">安卓使用videoview播放视频,做视频播放器需要SD卡读写权限.要不然可以找到视频文件,播放器显示无法播放视频.</h3> <div class="language-xml highlighter-rouge"><pre class="highlight"><code>
<span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.WRITE_EXTERNAL_STORAGE"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.MOUNT_UNMOUNT_FILESYSTEMS"</span><span class="nt">/&gt;</span>

</code></pre></div> <h3 id="app">让整个APP没有标题栏</h3> <div class="language-xml highlighter-rouge"><pre class="highlight"><code>
android:theme = "@android:style/Theme.Black.NoTitleBar.Fullscreen"

</code></pre></div> <h3 id="androidmanifestxmlactivity">强制横屏在AndroidManifest.xml的activity中</h3> <div class="language-xml highlighter-rouge"><pre class="highlight"><code>
android:launchMode = "singleTask"

android:screenorientation = "landscape"

</code></pre></div> <h3 id="section">让视频播放全屏</h3> <div class="language-java highlighter-rouge"><pre class="highlight"><code> <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">fullscreen</span><span class="o">:</span><span class="c1">//全屏/窗口切换</span>
      <span class="o">{</span>
       <span class="k">if</span><span class="o">(!</span><span class="n">fullscreenFlag</span><span class="o">){</span><span class="c1">//设置RelativeLayout的全屏模式</span>
        <span class="n">RelativeLayout</span><span class="o">.</span><span class="na">LayoutParams</span> <span class="n">layoutParams</span><span class="o">=</span><span class="k">new</span> <span class="n">RelativeLayout</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">(</span><span class="n">RelativeLayout</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">FILL_PARENT</span><span class="o">,</span> <span class="n">RelativeLayout</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">FILL_PARENT</span><span class="o">);</span>
            <span class="n">layoutParams</span><span class="o">.</span><span class="na">addRule</span><span class="o">(</span><span class="n">RelativeLayout</span><span class="o">.</span><span class="na">ALIGN_PARENT_BOTTOM</span><span class="o">);</span>
            <span class="n">layoutParams</span><span class="o">.</span><span class="na">addRule</span><span class="o">(</span><span class="n">RelativeLayout</span><span class="o">.</span><span class="na">ALIGN_PARENT_TOP</span><span class="o">);</span>
            <span class="n">layoutParams</span><span class="o">.</span><span class="na">addRule</span><span class="o">(</span><span class="n">RelativeLayout</span><span class="o">.</span><span class="na">ALIGN_PARENT_LEFT</span><span class="o">);</span>
            <span class="n">layoutParams</span><span class="o">.</span><span class="na">addRule</span><span class="o">(</span><span class="n">RelativeLayout</span><span class="o">.</span><span class="na">ALIGN_PARENT_RIGHT</span><span class="o">);</span>
            <span class="n">videoView</span><span class="o">.</span><span class="na">setLayoutParams</span><span class="o">(</span><span class="n">layoutParams</span><span class="o">);</span>
        <span class="o">}</span>

<span class="k">else</span><span class="o">{</span>
           <span class="n">RelativeLayout</span><span class="o">.</span><span class="na">LayoutParams</span> <span class="n">lp</span><span class="o">=</span><span class="k">new</span>  <span class="n">RelativeLayout</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">(</span><span class="n">RelativeLayout</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">MATCH_PARENT</span><span class="o">,</span><span class="n">RelativeLayout</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">MATCH_PARENT</span><span class="o">);</span>
           <span class="n">lp</span><span class="o">.</span><span class="na">addRule</span><span class="o">(</span><span class="n">RelativeLayout</span><span class="o">.</span><span class="na">ALIGN_PARENT_TOP</span><span class="o">);</span>
             <span class="n">videoView</span><span class="o">.</span><span class="na">setLayoutParams</span><span class="o">(</span><span class="n">lp</span><span class="o">);</span>

        <span class="o">}</span>    

<span class="n">fullscreenFlag</span> <span class="o">=</span> <span class="o">(!</span><span class="n">fullscreenFlag</span><span class="o">);</span><span class="k">break</span><span class="o">;</span>

      <span class="o">}</span>

</code></pre></div> <h3 id="section-1">进度条设计</h3> <p>在seekbar使用的过程中，出现了一个诡异的现象。duration是视频总长度，seekbar总长度是100。progress是进度条（0-100）的数值。定义了一个</p> <p>double time = （progress/100）* duration;计算数值总是0</p> <p>double time = （progress * duration）/100;得到的就是正确的数据。</p> <p>我最后使用了videoView.seekTo((int)time0);</p> <p>由此可见，应该是java编译器优化导致的，知道最后使用了一个int类型，优化成为每一步都使用int类型，这样progress/100就变成了0，0 * 其他数都为0。</p> <h3 id="section-2">至此，播放部分完成。</h3> <p>可以点击播放、停止、复位、进度条可以拖动控制播放进度（后期补全打开文件功能），软件截图如下：</p> </article> <div class="post-share"> <div class="container"> <a href="https://twitter.com/share?url=http://rzhengyang.me/2016/09/10/rzy_test2.html&text=Rzy_test2" target="_blank" class="post-share-icon twitter"></a> <a href="https://www.evernote.com/clip.action?url=http://rzhengyang.me/2016/09/10/rzy_test2.html&title=Rzy_test2" target="_blank" class="post-share-icon evernote"></a> <a href="http://service.weibo.com/share/share.php?url=http://rzhengyang.me/2016/09/10/rzy_test2.html&title=Rzy_test2" target="_blank" class="post-share-icon weibo"></a> </div> </div> <div class="ds-thread" data-thread-key="/2016/09/10/rzy_test2" data-title="Rzy_test2 | 羊兄台在这里" data-url="http://rzhengyang.me/2016/09/10/rzy_test2.html"></div> <!-- <script>var duoshuoQuery = {short_name:"rzhengyang"};</script> <script src="http://static.duoshuo.com/embed.js"></script> --> <div class="footer"> <div class="container"> </div> </div> </main> <button id="menu"> <span id="menu-icons"></span> </button> <script src="/assets/js/jquery-2.1.3.min.js"></script> <script src="/assets/js/jquery.pjax.js"></script> <script src="/assets/js/nprogress.js"></script> <script src="/assets/js/main.js"></script> </body> </html>
